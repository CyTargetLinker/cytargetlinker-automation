---
title: '[CTL] Compound / Disease Extension'
author: "mkutmon, scoort"
output: html_document
---

*Thanks to Alex Pico for his help to updating the scripts to RCy3*

## Step 0: Set up environment

### Install RCy3
Tested with RCy3 version 2.0.1 in R v3.5.0
```{r setup, include=FALSE}
source("https://bioconductor.org/biocLite.R")
biocLite("RCy3")
library(RCy3)
```

### Set working directory
```{r set working directory}
#install.packages("knitr")
library(knitr)
knitr:::input_dir()
```

### Test connection to Cytoscape and installed apps
```{r test connection}

cytoscapePing()

if("string" %in% commandsHelp("")) print("Success: the STRING app is installed") else print("Warning: STRING app is not installed. Please install the STRING app before proceeding.")
if("cytargetlinker" %in% commandsHelp("")) print("Success: the CyTargetLinker app is installed") else print("Warning: CyTargetLinker app is not installed. Please install the CyTargetLinker app before proceeding.")
```

*** 

## Step 1: Loading PPI network from STRING
Use Cytoscape to query the STRING database a network of proteins associated with the Rett syndrome

**If the STRING app is not installed, no error is reported, but your network  will be empty**
```{r disease query}
#define disease query, cutoff, species and limit
string.cmd = 'string disease query disease="Rett syndrome " cutoff=0.4 species="Homo sapiens" limit=20'
commandsRun(string.cmd)
```

![](https://github.com/CyTargetLinker/cytargetlinker-tutorials/blob/master/R/UseCase1/figures/Rett_syndrome_network.png){height=100%}

*** 

## Step 2: Extend network with compounds and diseases

**If the CyTargetLinker app is not installed, no error is reported, but your network  will not be extended**

**Load Linksets**
LinkSets can be downloaded from the CyTargetLinker website https://projects.bigcat.unimaas.nl/cytargetlinker/linksets/ and preprocessed as R objects. 
 
* ChEMBL
* OMIM rare disease subset

### Extend the network with protein-compound interactions from ChEMBL
```{r}
chembl <- file.path(getwd(), "LinkSets", "chembl_23_hsa_20180126.xgmml")
omim <- file.path(getwd(), "LinkSets", "rare-disease-gene-associations-hsa-20180411.xgmml")
CTLextend.cmd = paste('cytargetlinker extend idAttribute="display name" linkSetFiles="', chembl, ',', omim, '" network=current', sep="")
commandsRun(CTLextend.cmd)
```

### Apply a force-directed layout to the network
```{r}
CTLlayout.cmd = 'cytargetlinker applyLayout network=current'
commandsRun(CTLlayout.cmd)
```
![](https://github.com/CyTargetLinker/cytargetlinker-tutorials/blob/master/R/UseCase1/figures/Rett_syndrome_extended-v1.png){height=100%}

### Apply specific style for compound-disease networks
```{r}
vizstyle.file <- file.path(getwd(), "VizStyles", "use-case1-style.xml")
LoadStyle.cmd = paste('vizmap load file file="',vizstyle.file,'"', sep="")
commandsRun(LoadStyle.cmd)

setVisualStyle("CTL Disease Compound Network")
```
![](https://github.com/CyTargetLinker/cytargetlinker-tutorials/blob/master/R/UseCase1/figures/Rett_syndrome_extended-v2.png){height=100%}

*** 

## Step 3: Saving, sharing and publishing

### Saving a Cytoscape session file
Session files save *everything*. As with most project software, we recommend saving often!
```{r}
session.file <- file.path(getwd(), "Results", "RettSyndrome_Compound_Disease_Network.cys")
saveSession(session.file) #.cys
```

### Exporting high resolution image files
You can export extremely high resolution images, including vector graphic formats.
```{r}
pdf.file <- file.path(getwd(), "Results", "RettSyndrome_Compound_Disease_Network.pdf")
exportImage(pdf.file,'PDF')
png.file <- file.path(getwd(), "Results", "RettSyndrome_Compound_Disease_Network.png")
exportImage(png.file,'PNG')
```

### Exporting interactive web pages via cytoscape.js
You can export the network model in multiple standard formats. And if you want to get really fancy, you can export the model and style in cytoscape.js formats and host interactive views of your network analysis and visualization results online!
```{r}
cyjs.file <- file.path(getwd(), "Results", "RettSyndrome_Compound_Disease_Network.cyjs")
exportNetwork(cyjs.file,'CYJS')  #.cyjs
json.file <- file.path(getwd(), "Results", "RettSyndrome_Compound_Disease_Network.json")
exportVisualStyles(json.file,'JSON')
```

More details in Cytoscape manual chapter on [Interactive Web Applications](http://manual.cytoscape.org/en/stable/Export_Your_Data.html#as-an-interactive-web-application-new-in-3-2-0)


And in Cytoscape, you can File>Export as Web Page... to produce a folder of cytoscape.js files and html.